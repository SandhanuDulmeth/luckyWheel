<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lucky Wheel with Numbers</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2rem;
    }

    .wheel-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: auto;
    }

    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 5px solid #333;
      background: conic-gradient(
        #fff 0deg 30deg,
        #e74c3c 30deg 60deg,     /* Item 1 */
        #fff 60deg 90deg,
        #3498db 90deg 120deg,    /* Item 02 */
        #fff 120deg 150deg,
        #2ecc71 150deg 180deg,   /* Item 3 */
        #fff 180deg 210deg,
        #f1c40f 210deg 240deg,   /* Item 4 */
        #fff 240deg 270deg,
        #9b59b6 270deg 300deg,   /* Item 5 */
        #fff 300deg 330deg,
        #e67e22 330deg 360deg    /* Item 6 */
      );
      transition: transform 2s ease-out;
      transform: rotate(0deg);
      position: relative;
    }

    .arrow {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-bottom: 25px solid #000;
      z-index: 10;
    }

    .label {
      position: absolute;
      width: 100%;
      height: 100%;
      transform: rotate(0deg);
    }

    .label span {
      position: absolute;
      transform-origin: center;
      font-weight: bold;
      font-size: 18px;
      color: #000;
    }

    button {
      padding: 0.5rem 1.2rem;
      margin-top: 1rem;
      font-weight: bold;
      background: #333;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    table {
      border-collapse: collapse;
      width: 90%;
      margin: 2rem auto;
    }

    th, td {
      border: 1px solid #aaa;
      padding: 0.5rem;
    }

    th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>

  <h2>ðŸŽ¯ Lucky Wheel</h2>

  <div class="wheel-container">
    <div class="arrow"></div>
    <div class="wheel" id="wheel">
      <div class="label">
        <span style="top: 50%; left: 50%; transform: rotate(45deg) translateY(-130px) translateX(-50%);">1</span>
        <span style="top: 50%; left: 50%; transform: rotate(105deg) translateY(-130px) translateX(-50%);">2</span>
        <span style="top: 50%; left: 50%; transform: rotate(165deg) translateY(-130px) translateX(-50%);">3</span>
        <span style="top: 50%; left: 50%; transform: rotate(225deg) translateY(-130px) translateX(-50%);">4</span>
        <span style="top: 50%; left: 50%; transform: rotate(285deg) translateY(-130px) translateX(-50%);">5</span>
        <span style="top: 50%; left: 50%; transform: rotate(345deg) translateY(-130px) translateX(-50%);">6</span>
      </div>
    </div>
  </div>

  <button id="spinBtn">SPIN</button>

  <div style="margin: 1rem 0;">
    <label>Target Number:
      <input type="number" id="targetNumber" min="1" max="6" value="1" style="width: 3em;">
    </label>
    <label style="margin-left:1em;">Spin Count:
      <input type="number" id="spinCount" min="1" max="10" value="3" style="width: 3em;">
    </label>
  </div>

  <table>
    <thead>
      <tr>
        <th>ID</th><th>Name</th><th>Price</th><th>Qty</th><th>Times Won</th><th>Revenue</th>
      </tr>
    </thead>
    <tbody id="itemsTable"></tbody>
  </table>

  <script>
  const items = [
    { id: 1, name: 'Hole Grill Pan', price: 1050, qty: 1, won: 0, revenue: 0 },
    { id: 2, name: 'Knife Set', price: 670, qty: 1, won: 0, revenue: 0 },
    { id: 3, name: 'Waffles Maker', price: 1300, qty: 1, won: 0, revenue: 0 },
    { id: 4, name: 'Organizer', price: 730, qty: 1, won: 0, revenue: 0 },
    { id: 5, name: 'Travel Mug', price: 650, qty: 1, won: 0, revenue: 0 },
    { id: 6, name: 'Sharpener', price: 190, qty: 3, won: 0, revenue: 0 }
  ];

  const wheel = document.getElementById('wheel');
  const spinBtn = document.getElementById('spinBtn');
  const tableBody = document.getElementById('itemsTable');
  const sliceCount = 12;
  const sliceAngle = 360 / sliceCount;
  const itemIndexes = [1,3,5,7,9,11]; // Even slices are blanks

  function renderTable() {
    tableBody.innerHTML = '';
    items.forEach(item => {
      tableBody.innerHTML += `
        <tr>
          <td>${item.id}</td>
          <td>${item.name}</td>
          <td>â‚¹${item.price}</td>
          <td>${item.qty}</td>
          <td>${item.won}</td>
          <td>â‚¹${item.revenue}</td>
        </tr>
      `;
    });
    spinBtn.disabled = items.every(item => item.qty === 0);
  }

  function pickItem() {
    const available = items.filter(i => i.qty > 0);
    if (available.length === 0) return null;
    return available[Math.floor(Math.random() * available.length)];
  }


  // State for multi-spin
  let multiSpinState = null;
  let accumulatedRotation = 0;

  spinBtn.addEventListener('click', () => {
    if (spinBtn.disabled) return;

    // If not in a multi-spin session, initialize
    if (!multiSpinState) {
      accumulatedRotation = 0;
      const targetNum = parseInt(document.getElementById('targetNumber').value, 10);
      const spinTimes = parseInt(document.getElementById('spinCount').value, 10);
      if (isNaN(targetNum) || targetNum < 1 || targetNum > 6) {
        alert('Please enter a valid target number (1-6).');
        return;
      }
      if (isNaN(spinTimes) || spinTimes < 1) {
        alert('Please enter a valid spin count (>=1).');
        return;
      }
      const selected = items[targetNum - 1];
      if (!selected || selected.qty === 0) {
        alert('Selected item is not available!');
        return;
      }
      multiSpinState = {
        targetNum,
        spinTimes,
        currentSpin: 1,
        selected
      };
      // Optionally, disable inputs during session
      document.getElementById('targetNumber').disabled = true;
      document.getElementById('spinCount').disabled = true;
    }

    const { targetNum, spinTimes, selected } = multiSpinState;
    let { currentSpin } = multiSpinState;
    spinBtn.disabled = true;

    // Reset wheel rotation for each spin
    wheel.style.transition = 'none';
    wheel.style.transform = `rotate(${accumulatedRotation}deg)`;
    void wheel.offsetWidth;
    wheel.style.transition = 'transform 2s ease-out';

    let targetIndex;
    if (currentSpin < spinTimes) {
      // Pick a random index that is NOT the target
      const notTargetIndexes = itemIndexes.filter((idx, i) => i !== (targetNum - 1) && items[i].qty > 0);
      if (notTargetIndexes.length === 0) {
        // If all other items are out, just spin to a blank
        targetIndex = (itemIndexes[(targetNum) % 6] + 2) % 12;
      } else {
        targetIndex = notTargetIndexes[Math.floor(Math.random() * notTargetIndexes.length)];
      }
    } else {
      // Last spin: land on the target
      targetIndex = itemIndexes[targetNum - 1];
    }
    // Use a fixed spin count for animation
    const spins = 3;
    const spinAngle = spins * 360 + targetIndex * sliceAngle + sliceAngle / 2;
    accumulatedRotation += spinAngle;
    wheel.style.transform = `rotate(${accumulatedRotation}deg)`;

    setTimeout(() => {
      if (currentSpin < spinTimes) {
        multiSpinState.currentSpin++;
        spinBtn.disabled = false;
        if (multiSpinState.currentSpin === spinTimes) {
          spinBtn.textContent = 'FINAL SPIN';
        } else {
          spinBtn.textContent = `SPIN (${multiSpinState.currentSpin}/${spinTimes})`;
        }
      } else {
        // Only update stats on the last spin
        selected.qty--;
        selected.won++;
        selected.revenue += Math.ceil((selected.price + 200) / 100) * 100;
        alert(`ðŸŽ‰ You won: ${selected.name}\nCollected: â‚¹${Math.ceil((selected.price + 200) / 100) * 100}\nProfit: â‚¹${Math.ceil((selected.price + 200) / 100) * 100 - selected.price}`);
        renderTable();
        spinBtn.disabled = items.every(item => item.qty === 0);
        spinBtn.textContent = 'SPIN';
        document.getElementById('targetNumber').disabled = false;
        document.getElementById('spinCount').disabled = false;
        multiSpinState = null;
        accumulatedRotation = 0;
      }
    }, 2000);
  });

  renderTable();
  </script>
</body>
</html>
