//V12 - Fruit Wheel with Table Control
<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Fruit Spinning Wheel</title>
<style>
  :root { --size: 360px; }
  body { 
    height:100vh; 
    margin: 0;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    font-family:system-ui,Segoe UI,Roboto,Arial; 
    color: white;
    box-sizing: border-box;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    height: calc(100vh - 40px);
    display: flex;
    flex-direction: column;
  }
  
  .nav-tabs {
    display: flex;
    margin-bottom: 20px;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  
  .nav-tab {
    flex: 1;
    padding: 15px;
    background: rgba(255,255,255,0.1);
    border: none;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }
  
  .nav-tab.active {
    background: rgba(255,255,255,0.3);
  }
  
  .nav-tab:hover:not(.active):not(:disabled) {
    background: rgba(255,255,255,0.2);
  }
  
  .nav-tab:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  .page {
    display: none;
    flex: 1;
    overflow: hidden;
  }
  
  .page.active {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
  }
  
  .wheel-wrap { 
    position: relative; 
    width: var(--size); 
    height: var(--size); 
  }
  .wheel { 
    width:100%; 
    height:100%; 
    border-radius:50%; 
    border:8px solid #fff; 
    box-shadow:0 15px 35px rgba(0,0,0,0.3), 0 5px 15px rgba(0,0,0,0.2); 
    transform:rotate(0deg);
    transition: none;
  }
  .pointer { 
    position:absolute; 
    left:50%; 
    top:-25px; 
    transform:translateX(-50%); 
    width:0; 
    height:0; 
    border-left:20px solid transparent; 
    border-right:20px solid transparent; 
    border-bottom:40px solid #fff; 
    z-index:20;
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
  }
  .center { 
    position:absolute; 
    width:80px; 
    height:80px; 
    border-radius:50%; 
    background: linear-gradient(45deg, #fff, #f0f0f0); 
    top:calc(50% - 40px); 
    left:calc(50% - 40px); 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    font-weight:700; 
    border:6px solid #fff; 
    z-index:15;
    color: #333;
    font-size: 14px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    cursor: pointer;
  }
  
  .start-button {
    padding: 15px 30px;
    border-radius: 10px;
    border: 2px solid rgba(255,255,255,0.3);
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    cursor: pointer;
    color: white;
    font-weight: 600;
    font-size: 18px;
    transition: all 0.2s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  
  .start-button:hover:not(:disabled) {
    background: rgba(255,255,255,0.2);
    border-color: rgba(255,255,255,0.5);
    transform: translateY(-2px);
  }
  
  .start-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }
  
  #message { 
    color:#fff; 
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    min-height: 25px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  
  .segment-labels {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    pointer-events: none;
    z-index: 10;
    transition: none;
  }
  .segment-label {
    position: absolute;
    color: white;
    font-weight: bold;
    font-size: 14px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    transform-origin: center;
  }
  
  /* Table Page Styles */
  .table-container {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    max-width: 600px;
    width: 100%;
  }
  
  .table-title {
    font-size: 24px;
    font-weight: 700;
    text-align: center;
    margin-bottom: 20px;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  
  .fruit-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }
  
  .fruit-table th,
  .fruit-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid rgba(255,255,255,0.2);
  }
  
  .fruit-table th {
    background: rgba(255,255,255,0.2);
    font-weight: 600;
    color: white;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  }
  
  .fruit-table td {
    background: rgba(255,255,255,0.05);
    color: white;
  }
  
  .fruit-table tr:hover td {
    background: rgba(255,255,255,0.1);
  }
  
  .color-sample {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: inline-block;
    border: 2px solid white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  
  .checkbox-cell {
    text-align: center;
    width: 80px;
  }
  
  .fruit-checkbox {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: #4361ee;
  }
  
  .selection-info {
    text-align: center;
    color: rgba(255,255,255,0.8);
    font-style: italic;
    margin-top: 10px;
  }
  
  .debug {
    position: fixed;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 10px;
    border-radius: 5px;
    font-family: monospace;
    font-size: 12px;
    z-index: 100;
    display: none;
  }
</style>
</head>
<body>

<div class="container">
  <!-- Navigation Tabs -->
  <div class="nav-tabs">
    <button class="nav-tab active" id="tab-wheel" onclick="switchPage('wheel')">üé° Spin Wheel</button>
    <button class="nav-tab" id="tab-table" onclick="switchPage('table')">üçé Fruit Table</button>
  </div>
  
  <!-- Page 1: Spin Wheel -->
  <div class="page active" id="page-wheel">
    <div class="wheel-wrap">
      <div class="pointer" aria-hidden="true"></div>
      <div id="wheel" class="wheel" role="img" aria-label="Fruit wheel"></div>
      <div class="segment-labels" id="segmentLabels"></div>
      <div class="center" id="centerLabel">SPIN</div>
    </div>
    
    <button class="start-button" id="startButton" onclick="startSpin()">üöÄ Start Spin</button>
    <div id="message">Select a fruit in the table, then start spinning!</div>
  </div>
  
  <!-- Page 2: Fruit Table -->
  <div class="page" id="page-table">
    <div class="table-container">
      <h2 class="table-title">üçé Fruit Selection</h2>
      <table class="fruit-table">
        <thead>
          <tr>
            <th class="checkbox-cell">Select</th>
            <th>Fruit</th>
            <th>Color</th>
          </tr>
        </thead>
        <tbody id="fruitTableBody">
        </tbody>
      </table>
      <div class="selection-info" id="selectionInfo">
        Select one fruit to spin to
      </div>
    </div>
  </div>
</div>

<div id="debug" class="debug"></div>

<script>
// === CONFIG ===
const colors = ['#e63946','#f77f00','#ffbe0b','#8ac926','#2ec4b6','#4361ee','#9d4edd','#ff6fbf'];
const fruitNames = ['Apple','Orange','Banana','Lime','Mint','Blueberry','Grape','Strawberry'];
const segments = colors.length;
const segmentAngle = 360 / segments; // 45 degrees per segment

let currentPage = 'wheel';
let selectedFruitIndex = 0; // Default to first fruit
let currentRotation = 0;
let spinning = false;

// Build the wheel
const stops = [];
for (let i = 0; i < segments; i++){
  const start = i * segmentAngle;
  const end = start + segmentAngle;
  stops.push(`${colors[i]} ${start}deg ${end}deg`);
}

const wheel = document.getElementById('wheel');
wheel.style.background = `conic-gradient(from 0deg, ${stops.join(', ')})`;

// Initialize the application
function initializeApp() {
  updateWheelLabels();
  buildFruitTable();
  updateMessage();
}

// Update wheel segment labels
function updateWheelLabels() {
  const segmentLabels = document.getElementById('segmentLabels');
  segmentLabels.innerHTML = '';
  
  for (let i = 0; i < segments; i++) {
    const label = document.createElement('div');
    label.className = 'segment-label';
    label.textContent = fruitNames[i];
    
    // Position label at the center of each segment
    const centerAngle = i * segmentAngle + segmentAngle / 2;
    const angleRad = (centerAngle - 90) * Math.PI / 180; // -90 to start from top
    const radius = 120;
    const x = Math.cos(angleRad) * radius + 180;
    const y = Math.sin(angleRad) * radius + 180;
    
    label.style.left = x + 'px';
    label.style.top = y + 'px';
    label.style.transform = 'translate(-50%, -50%)';
    
    segmentLabels.appendChild(label);
  }
}

// Build fruit table
function buildFruitTable() {
  const tbody = document.getElementById('fruitTableBody');
  tbody.innerHTML = '';
  
  fruitNames.forEach((fruit, index) => {
    const row = document.createElement('tr');
    
    // Checkbox cell
    const checkboxCell = document.createElement('td');
    checkboxCell.className = 'checkbox-cell';
    const checkbox = document.createElement('input');
    checkbox.type = 'radio';
    checkbox.name = 'selectedFruit';
    checkbox.value = index;
    checkbox.className = 'fruit-checkbox';
    checkbox.checked = index === selectedFruitIndex;
    checkbox.addEventListener('change', () => selectFruit(index));
    checkboxCell.appendChild(checkbox);
    
    // Fruit name cell
    const nameCell = document.createElement('td');
    nameCell.textContent = fruit;
    
    // Color cell
    const colorCell = document.createElement('td');
    const colorSample = document.createElement('span');
    colorSample.className = 'color-sample';
    colorSample.style.backgroundColor = colors[index];
    colorCell.appendChild(colorSample);
    
    row.appendChild(checkboxCell);
    row.appendChild(nameCell);
    row.appendChild(colorCell);
    tbody.appendChild(row);
  });
}

// Handle fruit selection
function selectFruit(index) {
  selectedFruitIndex = index;
  updateMessage();
  updateSelectionInfo();
  
  // Update wheel labels immediately when selection changes
  updateWheelLabels();
}

// Update selection info
function updateSelectionInfo() {
  const info = document.getElementById('selectionInfo');
  info.textContent = `Selected: ${fruitNames[selectedFruitIndex]} - The wheel will stop here!`;
}

// Update message based on current state and page
function updateMessage() {
  const message = document.getElementById('message');
  if (spinning) {
    message.textContent = 'Spinning...';
  } else if (selectedFruitIndex >= 0) {
    message.textContent = `Ready to spin to: ${fruitNames[selectedFruitIndex]}!`;
  } else {
    message.textContent = 'Select a fruit in the table, then start spinning!';
  }
}

// Page switching
function switchPage(page) {
  if (spinning && page === 'table') {
    return; // Don't allow switching to table during spin
  }
  
  currentPage = page;
  
  // Update tab states
  document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  document.getElementById(`tab-${page}`).classList.add('active');
  
  // Update page visibility
  document.querySelectorAll('.page').forEach(p => {
    p.classList.remove('active');
  });
  document.getElementById(`page-${page}`).classList.add('active');
  
  if (page === 'table') {
    updateSelectionInfo();
  }
}

// Disable/enable table access
function setTableAccess(enabled) {
  const tableTab = document.getElementById('tab-table');
  tableTab.disabled = !enabled;
  
  if (!enabled && currentPage === 'table') {
    switchPage('wheel');
  }
}

// Start spinning
function startSpin() {
  if (spinning) return;
  
  if (selectedFruitIndex < 0) {
    alert('Please select a fruit from the table first!');
    switchPage('table');
    return;
  }
  
  spinToFruit(selectedFruitIndex);
}

// Get which segment the pointer is currently pointing at
function getCurrentSegment() {
  const normalizedRotation = ((currentRotation % 360) + 360) % 360;
  const target = (360 - normalizedRotation + 360) % 360;
  const segmentAtPointer = Math.floor(target / segmentAngle) % segments;
  return segmentAtPointer;
}

// Spin to specific fruit
function spinToFruit(targetIndex) {
  if (spinning) return;
  
  spinning = true;
  setTableAccess(false); // Disable table access during spin
  updateMessage();
  
  const centerLabel = document.getElementById('centerLabel');
  const startButton = document.getElementById('startButton');
  
  centerLabel.textContent = '...';
  startButton.disabled = true;
  
  // Calculate exact rotation to align target segment center with pointer
  const targetCenter = targetIndex * segmentAngle + (segmentAngle / 2);
  const desiredRotation = (360 - targetCenter) % 360;
  const currentMod = ((currentRotation % 360) + 360) % 360;
  let rotationNeeded = (desiredRotation - currentMod + 360) % 360;
  
  // Add extra spins for visual effect
  const extraSpins = 3 + Math.floor(Math.random() * 3);
  const totalRotation = rotationNeeded + (extraSpins * 360);
  const finalRotation = currentRotation + totalRotation;
  
  console.log(`üéØ Target: ${fruitNames[targetIndex]} (index ${targetIndex})`);
  console.log(`üîÑ Rotation: ${rotationNeeded}¬∞ + ${extraSpins * 360}¬∞ = ${totalRotation}¬∞`);
  
  // Animate to target
  animateRotation(currentRotation, finalRotation, 3500).then(() => {
    currentRotation = finalRotation;
    const landedSegment = getCurrentSegment();
    
    spinning = false;
    setTableAccess(true); // Re-enable table access
    startButton.disabled = false;
    
    centerLabel.textContent = fruitNames[landedSegment];
    
    const message = document.getElementById('message');
    message.textContent = `üéâ Landed on: ${fruitNames[landedSegment]}!`;
    
    if (landedSegment === targetIndex) {
      console.log(`‚úÖ SUCCESS! Perfect landing on ${fruitNames[landedSegment]}`);
    } else {
      console.warn(`‚ùå MISMATCH! Expected ${fruitNames[targetIndex]}, got ${fruitNames[landedSegment]}`);
    }
  });
}

function easeOutCubic(t){ 
  return 1 - Math.pow(1 - t, 3); 
}

function animateRotation(startRotation, endRotation, duration = 3500) {
  return new Promise((resolve) => {
    const startTime = performance.now();
    const rotationDelta = endRotation - startRotation;
    const segmentLabels = document.getElementById('segmentLabels');
    
    function animate(currentTime) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const easedProgress = easeOutCubic(progress);
      
      const currentRot = startRotation + (rotationDelta * easedProgress);
      wheel.style.transform = `rotate(${currentRot}deg)`;
      segmentLabels.style.transform = `rotate(${currentRot}deg)`;
      
      currentRotation = currentRot;
      
      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        currentRotation = endRotation;
        wheel.style.transform = `rotate(${endRotation}deg)`;
        segmentLabels.style.transform = `rotate(${endRotation}deg)`;
        resolve();
      }
    }
    
    requestAnimationFrame(animate);
  });
}

// Make center clickable for random spin
document.getElementById('centerLabel').addEventListener('click', () => {
  if (spinning) return;
  const randomIndex = Math.floor(Math.random() * segments);
  selectedFruitIndex = randomIndex;
  
  // Update table selection
  const radioButtons = document.querySelectorAll('input[name="selectedFruit"]');
  radioButtons.forEach((radio, index) => {
    radio.checked = index === randomIndex;
  });
  
  updateSelectionInfo();
  spinToFruit(randomIndex);
});

// Debug toggle
document.addEventListener('keydown', (e) => {
  if (e.key === 'd') {
    const debugDiv = document.getElementById('debug');
    debugDiv.style.display = debugDiv.style.display === 'none' ? 'block' : 'none';
  }
});

// Initialize the application
initializeApp();

console.log('üçé Fruit Wheel Loaded! Press "d" to toggle debug info');
</script>

</body>
</html>